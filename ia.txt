const mineflayer = require('mineflayer');
const axios = require('axios');

const bot = mineflayer.createBot({
  host: 'localhost', // IP do servidor Minecraft
  port: 25565,       // Porta do servidor
  username: 'BotGPT' // Nome do bot
});

const openRouterKey = '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';
const systemPrompt = "Você é um NPC inteligente em um servidor de Minecraft, ajude os jogadores com respostas úteis e criativas.";

bot.on('chat', async (username, message) => {
  // Ignora a própria mensagem do bot
  if (username === bot.username) return;

  // Apenas responde mensagens diretamente direcionadas ao bot
  if (!message.toLowerCase().includes('bot') && !message.toLowerCase().includes('gpt')) return;

  const prompt = `Jogador ${username} disse: "${message}". Responda de forma inteligente no contexto do Minecraft.`;

  try {
    const response = await axios.post(
      'https://openrouter.ai/api/v1/chat/completions',
      {
        model: 'openchat/openchat-3.5',
        messages: [
          { role: 'system', content: systemPrompt },
          { role: 'user', content: prompt }
        ]
      },
      {
        headers: {
          Authorization: `Bearer ${openRouterKey}`,
          'Content-Type': 'application/json'
        }
      }
    );

    const reply = response.data.choices[0].message.content;
    bot.chat(`${username}, ${reply}`);
  } catch (error) {
    console.error('Erro ao chamar OpenRouter:', error.message);
    bot.chat(`Desculpe ${username}, não consegui pensar em uma resposta agora.`);
  }
});