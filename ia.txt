const mineflayer = require('mineflayer');

const bot = mineflayer.createBot({
  host: 'localhost',
  port: 25565,
  username: 'EscudoBot'
});

function isShield(item) {
  return item && item.name === 'shield';
}

bot.on('spawn', () => {
  console.log('Bot conectado.');
});

// Verifica inventário sempre que houver atualização
bot.on('windowUpdate', () => {
  const items = bot.inventory.items();

  for (let item of items) {
    if (isShield(item)) {
      equipShield(item);
    } else if (bot.canEquip(item, 'hand')) {
      equipMain(item);
    }
  }
});

// Equipar na mão principal
function equipMain(item) {
  bot.equip(item, 'hand').then(() => {
    console.log(`Equipado na mão principal: ${item.name}`);
  }).catch(console.error);
}

// Equipar escudo na mão secundária e segurar botão de uso
function equipShield(item) {
  bot.equip(item, 'off-hand').then(() => {
    console.log('Escudo equipado na mão secundária.');
    bot.setControlState('use', true); // Segura o botão direito
  }).catch(console.error);
}

// Garante que o escudo seja reativado se ele for jogado fora e readquirido
bot.on('itemDrop', () => {
  bot.setControlState('use', false);
});

bot.on('itemPickup', () => {
  // Espera um pouco e reanalisa o inventário para reagir ao item novo
  setTimeout(() => {
    bot.emit('windowUpdate');
  }, 300);
});